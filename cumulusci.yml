minimum_cumulusci_version: '3.0.2'
project:
    name: DeclarativeTestGeneration
    package:
        name:  DeclarativeTestGeneration
        api_version: '47'
    dependencies:
        - github: 'https://github.com/selfuntitled/apex-toolingapi'
          ref: cca0e486c0e7acaaea194bbf08385d68cba9944f

tasks:
    robot:
        options:
            suites: robot/DeclarativeTestGeneration/tests
            options:
                outputdir: robot/DeclarativeTestGeneration/results

    robot_testdoc:
        options:
            path: robot/DeclarativeTestGeneration/tests
            output: robot/DeclarativeTestGeneration/doc/DeclarativeTestGeneration_tests.html
            
flows:
    deploy_unmanaged:
        description: Deploy the unmanaged metadata from the package
        steps:
            0:
                task: dx_convert_from
                when: project_config.project__source_format == "sfdx" and not org_config.scratch
            1:
                task: update_package_xml
                when: project_config.project__source_format != "sfdx" or not org_config.scratch
            2:
                task: deploy
                when: project_config.project__source_format != "sfdx" or not org_config.scratch
            2.1:
                task: dx_push
                when: project_config.project__source_format == "sfdx" and org_config.scratch
            3:
                task: uninstall_packaged_incremental
                when: project_config.project__source_format != "sfdx" or not org_config.scratch
